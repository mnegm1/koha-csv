<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Koha AI Assistant</title>
<style>
:root{
  --brand:#BF9849;
  --logo-url:url("https://assets.almanhal.com/platform/shared/Product/ECSSR/middlelogo.png");
  --logo-size:140%;
  --fab-size:64px;

  /* text arc */
  --label-text:"AI Assist";
  --label-color:#3EA3DC;
  --label-size:18px;
  --arc-gap:2px;
  --arc-start:5;
  --arc-end:85;
}

/* ==== main FAB + arc ==== */
.fab-wrap{position:fixed;right:18px;bottom:18px;z-index:9999;pointer-events:none;}
.fab{position:absolute;right:0;bottom:0;width:var(--fab-size);height:var(--fab-size);
     background:#fff var(--logo-url) center/var(--logo-size) no-repeat;
     border:4px solid var(--brand);border-radius:50%;box-shadow:0 8px 20px rgba(0,0,0,.25);
     cursor:pointer;pointer-events:auto;}
.fab-label{position:absolute;inset:0;pointer-events:none;}
.fab-label text{fill:var(--label-color);font-weight:900;font-size:var(--label-size);}

/* small bounce to catch eye */
@keyframes bounce{0%,100%{transform:translateY(0);}50%{transform:translateY(-8px);}}
.fab.attn{animation:bounce 1.8s ease-in-out 1;}

/* ==== chat box ==== */
.box{position:fixed;right:18px;bottom:calc(18px + var(--fab-size) + 10px);
     width:min(420px,90vw);max-height:65vh;display:none;flex-direction:column;
     background:#fff;border:1px solid #e8eef3;border-radius:14px;
     box-shadow:0 10px 30px rgba(0,0,0,.3);overflow:hidden;z-index:9999;}
.head{background:var(--brand);color:#fff;font-weight:600;
      padding:10px 14px;display:flex;justify-content:space-between;}
.body{padding:10px;overflow:auto;flex:1;font-size:14px;}
.row{background:#f6f9fc;border:1px solid #e7edf4;border-radius:10px;padding:10px;margin:8px 0;}
.input{display:flex;gap:6px;padding:10px;background:#fafafa;border-top:1px solid #e8eef3;}
.input input{flex:1;padding:8px;border-radius:8px;border:1px solid #cfd9e3;}
.input button{background:var(--brand);color:#fff;border:none;border-radius:8px;padding:8px 12px;font-weight:600;cursor:pointer;}
</style>
</head>
<body>

<script>
/* === helper to draw readable clockwise arc === */
function drawArc(){
  const cs=getComputedStyle(document.documentElement);
  const size=parseFloat(cs.getPropertyValue('--fab-size'));
  const gap=parseFloat(cs.getPropertyValue('--arc-gap'))||2;
  const r=(size/2)+gap+4;
  const pad=20, box=(r+pad)*2;
  const cx=box-(size/2)-pad, cy=box-(size/2)-pad;
  const a0=parseFloat(cs.getPropertyValue('--arc-start'))||0;
  const a1=parseFloat(cs.getPropertyValue('--arc-end'))||90;
  const rad=Math.PI/180;
  const p=(deg)=>({x:cx+r*Math.cos(deg*rad),y:cy-r*Math.sin(deg*rad)});
  const p0=p(a0), p1=p(a1);
  const large=(Math.abs(a1-a0)>180)?1:0, sweep=0;
  const d=`M${p0.x},${p0.y} A${r},${r} 0 ${large},${sweep} ${p1.x},${p1.y}`;
  const svg=document.createElementNS("http://www.w3.org/2000/svg","svg");
  svg.setAttribute("class","fab-label");
  svg.setAttribute("viewBox",`0 0 ${box} ${box}`);
  svg.innerHTML=`<defs><path id="arc" d="${d}"/></defs>
    <text><textPath href="#arc">${cs.getPropertyValue('--label-text').replace(/["']/g,"")}</textPath></text>`;
  return svg;
}

/* === build floating icon === */
const wrap=document.createElement("div");wrap.className="fab-wrap";
const fab=document.createElement("button");fab.className="fab attn";fab.title="AI Assistant";
wrap.appendChild(drawArc());wrap.appendChild(fab);document.body.appendChild(wrap);

/* === chat box === */
const box=document.createElement("div");box.className="box";
box.innerHTML=`<div class="head">AI Assistant <button id="close" style="background:none;border:none;color:#fff;font-size:18px;cursor:pointer">×</button></div>
<div class="body" id="body"></div>
<div class="input"><input id="q" placeholder="Search / ابحث" dir="auto"><button id="go">Search</button></div>`;
document.body.appendChild(box);
const B=box.querySelector("#body"),Q=box.querySelector("#q"),GO=box.querySelector("#go");
fab.onclick=()=>{box.style.display=box.style.display==="flex"?"none":"flex";if(box.style.display==="flex")Q.focus();};
box.querySelector("#close").onclick=()=>box.style.display="none";

/* === fake data + search (restore yours later) === */
const DATA=[
 {title:"AI and Libraries",author:"Dr Negm",summary:"Exploring AI in Koha."},
 {title:"Arabic Cataloging Guide",author:"ECSSR Library",summary:"Metadata in Arabic."},
 {title:"Digital Transformation",author:"ECSSR",summary:"Strategies for smart libraries."}
];
function search(q){
  const n=q.toLowerCase();
  return DATA.filter(x=>x.title.toLowerCase().includes(n)||x.author.toLowerCase().includes(n)||x.summary.toLowerCase().includes(n));
}
GO.onclick=()=>{const qv=Q.value.trim();if(!qv)return;const r=search(qv);
  B.innerHTML=r.map(x=>`<div class="row"><b>${x.title}</b><br>${x.author}<br><small>${x.summary}</small></div>`).join("")||
  '<div class="row">No results</div>';
};
Q.onkeydown=e=>{if(e.key==="Enter")GO.click();}
</script>
</body>
</html>
